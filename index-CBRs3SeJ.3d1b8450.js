!function(e,t,r,s,n){var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a="function"==typeof i[s]&&i[s],o=a.cache||{},c="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function d(t,r){if(!o[t]){if(!e[t]){var n="function"==typeof i[s]&&i[s];if(!r&&n)return n(t,!0);if(a)return a(t,!0);if(c&&"string"==typeof t)return c(t);var f=Error("Cannot find module '"+t+"'");throw f.code="MODULE_NOT_FOUND",f}b.resolve=function(r){var s=e[t][1][r];return null!=s?s:r},b.cache={};var l=o[t]=new d.Module(t);e[t][0].call(l.exports,b,l,l.exports,i)}return o[t].exports;function b(e){var t=b.resolve(e);return!1===t?{}:d(t)}}d.isParcelRequire=!0,d.Module=function(e){this.id=e,this.bundle=d,this.exports={}},d.modules=e,d.cache=o,d.parent=a,d.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]},Object.defineProperty(d,"root",{get:function(){return i[s]}}),i[s]=d;for(var f=0;f<t.length;f++)d(t[f])}({iYmUA:[function(e,t,r,s){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"AptosCircleBridge",()=>h);var i=e("./chunk-IMTC3J2M-C38GWJzD.mjs"),a=e("./index-DTF6KsXj.mjs"),o=e("./aptos-BDX0H0Be.mjs"),c=e("./unsignedTransaction-BDOQhqcZ.mjs"),d=Object.defineProperty,f=(e,t,r)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,l=(e,t,r)=>f(e,"symbol"!=typeof t?t+"":t,r);let b=(0,a.cj)([["Mainnet",{depositForBurn:"0xa11ceb0b0700000a0701000802080e031614042a04052e30075e870108e5014000000001000201030004000001050701000100060b0001070304010801020805060108010309080900010002010205060c030e05050208000b010108020108020105010b0101090003060c0b01010900030108000004060c08000e0501030e66756e6769626c655f6173736574066f626a656374167072696d6172795f66756e6769626c655f73746f72650f746f6b656e5f6d657373656e6765720d46756e6769626c654173736574064f626a656374084d6574616461746111616464726573735f746f5f6f626a656374087769746864726177106465706f7369745f666f725f6275726e00000000000000000000000000000000000000000000000000000000000000019bce6734f7b63e835108e3bd8c36743d4709fe435f44791918801d0989640a9d0000010f0b0438000c060a000b060b0138010c050b000b050b020b0311020102",handleReceiveMessage:"0xa11ceb0b0700000a0601000402040403080c051416072a53087d40000001010002000000030203000101040304000103060c0a020a020003060c060a02060a020108000101136d6573736167655f7472616e736d69747465720f746f6b656e5f6d657373656e67657207526563656970740f726563656976655f6d6573736167651668616e646c655f726563656976655f6d657373616765177e17751820e4b4371873ca8c30279be63bdea63b88ed0f2239c2eea10f17729bce6734f7b63e835108e3bd8c36743d4709fe435f44791918801d0989640a9d000001070b000e010e02110011010102"}],["Testnet",{depositForBurn:"0xa11ceb0b0700000a0701000802080e031614042a04052e30075e870108e5014000000001000201030004000001050701000100060b0001070304010801020805060108010309080900010002010205060c030e05050208000b010108020108020105010b0101090003060c0b01010900030108000004060c08000e0501030e66756e6769626c655f6173736574066f626a656374167072696d6172795f66756e6769626c655f73746f72650f746f6b656e5f6d657373656e6765720d46756e6769626c654173736574064f626a656374084d6574616461746111616464726573735f746f5f6f626a656374087769746864726177106465706f7369745f666f725f6275726e00000000000000000000000000000000000000000000000000000000000000015f9b937419dda90aa06c1836b7847f65bbbe3f1217567758dc2488be31a477b90000010f0b0438000c060a000b060b0138010c050b000b050b020b0311020102",handleReceiveMessage:"0xa11ceb0b0700000a0601000402040403080c051416072a53087d40000001010002000000030203000101040304000103060c0a020a020003060c060a02060a020108000101136d6573736167655f7472616e736d69747465720f746f6b656e5f6d657373656e67657207526563656970740f726563656976655f6d6573736167651668616e646c655f726563656976655f6d657373616765081e86cebf457a0c6004f35bd648a2794698f52e0dde09a48619dcd3d4cc23d95f9b937419dda90aa06c1836b7847f65bbbe3f1217567758dc2488be31a477b9000001070b000e010e02110011010102"}]],[0,1]);class h{constructor(e,t,r,s){var n,i,o;if(l(this,"network"),l(this,"chain"),l(this,"provider"),l(this,"contracts"),l(this,"usdcId"),l(this,"tokenMessengerId"),l(this,"messageTransmitterId"),l(this,"moveScripts"),this.network=e,this.chain=t,this.provider=r,this.contracts=s,"Devnet"===e)throw Error("CircleBridge not supported on Devnet");let c=(0,a.bw).get(this.network,this.chain);if(!c)throw Error(`No USDC contract configured for network=${this.network} chain=${this.chain}`);if(!(null!=(n=s.cctp)&&n.tokenMessenger))throw Error(`Circle Token Messenger contract for domain ${t} not found`);if(!(null!=(i=s.cctp)&&i.messageTransmitter))throw Error(`Circle Message Transmitter contract for domain ${t} not found`);if(!b.has(e))throw Error("No Aptos CCTP move scripts found");this.usdcId=c,this.tokenMessengerId=null==(o=s.cctp)?void 0:o.tokenMessenger,this.messageTransmitterId=s.cctp.messageTransmitter,this.moveScripts=b.get(e)}async *transfer(e,t,r){let s=new i.N((0,a.bu).get(this.network,t.chain)),n=(0,i.l).from(this.usdcId),o=(0,i.l).from(t.address.toUniversalAddress().toUint8Array()),c=[new i.O(r),s,o,n],d={bytecode:this.moveScripts.depositForBurn,functionArguments:c};yield this.createUnsignedTx(d,"Aptos.CircleBridge.Transfer")}async isTransferCompleted(e){let t=new(0,i.N)(e.sourceDomain).bcsToBytes(),r=new(0,i.O)(e.nonce).bcsToBytes(),s=(0,a.bD)(new Uint8Array([...t,45,...r])),n=(0,a.r).encode(s);return(await this.provider.view({payload:{function:`${this.messageTransmitterId}::message_transmitter::is_nonce_used`,functionArguments:[n]}}))[0]}async *redeem(e,t,r){let s=[(0,i.P).U8((0,a.bv).serialize(t)),(0,i.P).U8((0,a.r).decode(r))],n={bytecode:this.moveScripts.handleReceiveMessage,functionArguments:s};yield this.createUnsignedTx(n,"Aptos.CircleBridge.Redeem")}async parseTransactionDetails(e){var t;let r=await this.provider.getTransactionByHash({transactionHash:e}),s=this.messageTransmitterId.replace(/^0x0+/,"0x"),n=null==(t=r.events)?void 0:t.find(e=>e.type===`${s}::message_transmitter::MessageSent`);if(!n)throw Error("No MessageSent event found");let i=(0,a.r).decode(n.data.message),[o,c]=(0,a.bv).deserialize(i),{payload:d}=o,f=d.messageSender,l=d.mintRecipient,b=(0,a.bx)(this.network,o.sourceDomain),h=(0,a.bx)(this.network,o.destinationDomain),u={chain:b,address:d.burnToken};return{from:{chain:b,address:f},to:{chain:h,address:l},token:u,amount:d.amount,message:o,id:{hash:c}}}static async fromRpc(e,t){let[r,s]=await (0,o.A).chainFromRpc(e),n=t[s];if(n.network!==r)throw Error(`Network mismatch: ${n.network} != ${r}`);return new h(r,s,e,n.contracts)}createUnsignedTx(e,t,r=!1){return new c.A(e,this.network,this.chain,t,r)}}(0,a.bj)("Aptos","CircleBridge",h)},{"./chunk-IMTC3J2M-C38GWJzD.mjs":"ele29","./index-DTF6KsXj.mjs":"ieLDt","./aptos-BDX0H0Be.mjs":"d6zRe","./unsignedTransaction-BDOQhqcZ.mjs":"jlFJo","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],jlFJo:[function(e,t,r,s){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"A",()=>c);var i=Object.defineProperty,a=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o=(e,t,r)=>a(e,"symbol"!=typeof t?t+"":t,r);class c{constructor(e,t,r,s,n=!1){o(this,"transaction"),o(this,"network"),o(this,"chain"),o(this,"description"),o(this,"parallelizable"),this.transaction=e,this.network=t,this.chain=r,this.description=s,this.parallelizable=n}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}]},[],0,"parcelRequire94c2");
//# sourceMappingURL=index-CBRs3SeJ.3d1b8450.js.map
