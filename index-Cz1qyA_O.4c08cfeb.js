!function(e,t,r,n,i){var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a="function"==typeof o[n]&&o[n],s=a.cache||{},d="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(t,r){if(!s[t]){if(!e[t]){var i="function"==typeof o[n]&&o[n];if(!r&&i)return i(t,!0);if(a)return a(t,!0);if(d&&"string"==typeof t)return d(t);var u=Error("Cannot find module '"+t+"'");throw u.code="MODULE_NOT_FOUND",u}l.resolve=function(r){var n=e[t][1][r];return null!=n?n:r},l.cache={};var h=s[t]=new c.Module(t);e[t][0].call(h.exports,l,h,h.exports,o)}return s[t].exports;function l(e){var t=l.resolve(e);return!1===t?{}:c(t)}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=e,c.cache=s,c.parent=a,c.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]},Object.defineProperty(c,"root",{get:function(){return o[n]}}),o[n]=c;for(var u=0;u<t.length;u++)c(t[u])}({hNIAi:[function(e,t,r,n){var i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(r),i.export(r,"EvmPorticoBridge",()=>p);var o=e("./index-DTF6KsXj.mjs"),a=e("./index-qL9Yg_9W.mjs"),s=Object.defineProperty,d=(e,t,r)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,c=(e,t,r)=>d(e,"symbol"!=typeof t?t+"":t,r);let u=new o.b5(["function start((bytes32,address,address,address,address,address,uint256,uint256,uint256,uint256)) returns (address,uint16,uint64)","function receiveMessageAndSwap(bytes)"]),h=new o.b5(["function quoteExactInputSingle((address,address,uint256,uint24,uint160)) public view returns (uint256,uint160,uint32,uint256)"]);class l{static async quoteRelayer(e,t,r){var n;if((0,o.m)(t)||(0,o.m)(r))throw Error("how did you get here tho?");let i=(0,o.r).encode(t.toUniversalAddress().toUint8Array(),!1),a=(0,o.r).encode(r.toUniversalAddress().toUint8Array(),!1),s={targetChain:(0,o.b6)(e),sourceToken:i,targetToken:a};try{let e=await (0,o.az).post("https://gfx.relayers.xlabs.xyz/api/v1/swap/quote",s);return BigInt(e.data.fee)}catch(e){throw(0,o.az).isAxiosError(e)?Error(`Error getting relayer fee: ${null==(n=e.response)?void 0:n.statusText}`):e}}}let f={ETH:[(0,o.j).tokenId("Arbitrum","native"),(0,o.j).tokenId("Base","native"),(0,o.j).tokenId("Ethereum","native"),(0,o.j).tokenId("Optimism","native")],WETH:[(0,o.j).tokenId("Arbitrum","0x82aF49447D8a07e3bd95BD0d56f35241523fBab1"),(0,o.j).tokenId("Avalanche","0x49D5c2BdFfac6CE2BFdB6640F4F80f226bc10bAB"),(0,o.j).tokenId("Base","0x4200000000000000000000000000000000000006"),(0,o.j).tokenId("Bsc","0x2170Ed0880ac9A755fd29B2688956BD959F933F8"),(0,o.j).tokenId("Ethereum","0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),(0,o.j).tokenId("Optimism","0x4200000000000000000000000000000000000006"),(0,o.j).tokenId("Polygon","0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619")],wstETH:[(0,o.j).tokenId("Arbitrum","0x5979D7b546E38E414F7E9822514be443A4800529"),(0,o.j).tokenId("Base","0xc1CBa3fCea344f92D9239c08C0568f6F2F0ee452"),(0,o.j).tokenId("Ethereum","0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0"),(0,o.j).tokenId("Optimism","0x1F32b1c2345538c0c6f582fCB022739c4A194Ebb"),(0,o.j).tokenId("Polygon","0x03b54A6e9a984069379fae1a4fC4dBAE93B3bCCD")],USDT:[(0,o.j).tokenId("Arbitrum","0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9"),(0,o.j).tokenId("Avalanche","0x9702230A8Ea53601f5cD2dc00fDBc13d4dF4A8c7"),(0,o.j).tokenId("Base","0xfde4C96c8593536E31F229EA8f37b2ADa2699bb2"),(0,o.j).tokenId("Bsc","0x55d398326f99059fF775485246999027B3197955"),(0,o.j).tokenId("Ethereum","0xdAC17F958D2ee523a2206206994597C13D831ec7"),(0,o.j).tokenId("Optimism","0x94b008aA00579c1307B0EF2c499aD98a8ce58e58"),(0,o.j).tokenId("Polygon","0xc2132D05D31c914a87C6611C10748AEb04B58e8F"),(0,o.j).tokenId("Celo","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e")]};class p{constructor(e,t,r,n){if(c(this,"network"),c(this,"chain"),c(this,"provider"),c(this,"contracts"),c(this,"chainId"),c(this,"core"),c(this,"tokenBridge"),this.network=e,this.chain=t,this.provider=r,this.contracts=n,!n.portico)throw Error("Unsupported chain, no contract addresses for: "+t);this.core=new o.b7(e,t,r,n),this.tokenBridge=new a.EvmTokenBridge(e,t,r,n),this.chainId=(0,o.b8).get(e,t)}static async fromRpc(e,t){let[r,n]=await (0,o.E).chainFromRpc(e),i=t[n];if(i.network!==r)throw Error(`Network mismatch: ${i.network} != ${r}`);return new p(r,n,e,i.contracts)}async *transfer(e,t,r,n,i,a,s){let{minAmountStart:d,minAmountFinish:c}=s.swapAmounts;if(0n===d||0n===c)throw Error("Invalid min swap amount");let h=new(0,o.b)(e).toString(),[l,f]=(0,o.b9)(this.network,this.chain,r),[p,b]=(0,o.b9)(this.network,t.chain,i),g=(0,o.ba)(f),w=(0,o.ba)(await this.getTransferrableToken(g)),k=(0,o.ba)(t),m=(0,o.ba)(b),y=new Date().valueOf()%16,A=(0,o.bb).serializeFlagSet({flags:{shouldWrapNative:l,shouldUnwrapNative:p},recipientChain:(0,o.b6)(t.chain),bridgeNonce:y,feeTierStart:100,feeTierFinish:100,padding:new Uint8Array(19)}),E=u.encodeFunctionData("start",[[A,g.toLowerCase(),w,m.toLowerCase(),k,a,n.toString(),d.toString(),c.toString(),s.relayerFee.toString()]]),v=this.getTokenGroup(f.address.toString()),j=this.getPorticoAddress(v);l||(yield*this.approve(g,h,n,j));let C=await this.core.getMessageFee();yield this.createUnsignedTransaction((0,o.bc)({to:j,data:E,value:C+(l?n:0n)},h),"PorticoBridge.Transfer")}async *redeem(e,t){let r=(0,o.bd)(t.payload.payload.flagSet.recipientChain),n=t.payload.payload.finalTokenAddress.toNative(r).toString(),i=this.getTokenGroup(n),a=this.getPorticoAddress(i),s=await new(0,o.a4)(a,u.fragments,this.provider).getFunction("receiveMessageAndSwap").populateTransaction((0,o.be)(t)),d=new(0,o.b)(e).toString();yield this.createUnsignedTransaction((0,o.bc)(s,d),"PorticoBridge.Redeem")}async isTransferCompleted(e){return await this.tokenBridge.tokenBridge.isTransferCompleted((0,o.bf)(e.hash))}async quoteSwap(e,t,r,n){let[,i]=(0,o.b9)(this.network,this.chain,e),[,a]=(0,o.b9)(this.network,this.chain,t),s=(0,o.ba)(i),d=(0,o.ba)(a);if((0,o.bg)(s,d))return n;let c=this.getQuoterAddress(r);return(await new(0,o.a4)(c,h.fragments,this.provider).getFunction("quoteExactInputSingle").staticCall([s,d,n,100,0]))[0]}async quoteRelay(e,t){return await l.quoteRelayer(this.chain,e,t)}async getTransferrableToken(e){let t=(0,o.j).tokenId(this.chain,e),[,r]=(0,o.b9)(this.network,this.chain,t);if("Ethereum"===this.chain)return r;let n=Object.values(f).find(e=>e.find(e=>e.chain===this.chain&&(0,o.ba)(e)===(0,o.ba)(r)));if(!n)throw Error(`No token group found for ${e} on ${this.chain}`);let i=n.find(e=>"Ethereum"===e.chain);if(!i)throw Error(`No Ethereum origin token found for ${e} on ${this.chain}`);let a=await this.tokenBridge.getWrappedAsset(i);return(0,o.j).tokenId(this.chain,a.toString())}supportedTokens(){let e=[];for(let[t,r]of Object.entries(f))for(let n of r)n.chain===this.chain&&e.push({group:t,token:n});return e}getTokenGroup(e){let t=this.supportedTokens().find(t=>(0,o.ba)(t.token)===e);if(!t)throw Error("Token not found");return t.group}async *approve(e,t,r,n){let i=(0,o.E).getTokenImplementation(this.provider,e);if(await i.allowance(t,n)<r){let e=await i.approve.populateTransaction(n,r);yield this.createUnsignedTransaction((0,o.bc)(e,t),"PorticoBridge.Approve")}}createUnsignedTransaction(e,t){return new o.bh((0,o.bi)(e,this.chainId),this.network,this.chain,t,!1)}getPorticoAddress(e){let t=this.contracts.portico;return"USDT"===e&&t.porticoPancakeSwap||t.porticoUniswap}getQuoterAddress(e){let t=this.contracts.portico;return"USDT"===e&&t.pancakeSwapQuoterV2||t.uniswapQuoterV2}}(0,o.bj)(o._,"PorticoBridge",p)},{"./index-DTF6KsXj.mjs":"ieLDt","./index-qL9Yg_9W.mjs":"j5aZw","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}]},[],0,"parcelRequire94c2");
//# sourceMappingURL=index-Cz1qyA_O.4c08cfeb.js.map
